<!DOCTYPE html>
<html>
<head>
    <title>Reset Users - Baghoor Oil Traders</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body style="font-family: Arial; padding: 40px; background: #f5f5f5;">
    <div style="max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h1>üîß Reset User Credentials</h1>
        <p>This will reset the system users to default credentials.</p>
        
        <button onclick="resetUsers()" style="background: #4CAF50; color: white; padding: 15px 30px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer;">
            Reset to Default Users
        </button>
        
        <div id="status" style="margin-top: 20px; padding: 15px; border-radius: 5px; display: none;"></div>
        
        <div style="margin-top: 30px; padding: 15px; background: #f9f9f9; border-radius: 5px;">
            <h3>Default Credentials:</h3>
            <ul>
                <li><strong>Admin:</strong> admin / admin123</li>
                <li><strong>Manager:</strong> manager / manager123</li>
                <li><strong>Accountant:</strong> accountant / accountant123</li>
            </ul>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://druxbksscacocuclnzxs.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRydXhia3NzY2Fjb2N1Y2xuenhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3NTMyOTQsImV4cCI6MjA3NzMyOTI5NH0._tlLjLoBVwI2hFKqpLFupERMN2ouvyDc-JG1rf574u0';
        
        const { createClient } = window.supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        const DEFAULT_USERS = [
            { id: 'user_1', username: 'admin', password: 'admin123', role: 'admin', createdAt: new Date().toISOString() },
            { id: 'user_2', username: 'manager', password: 'manager123', role: 'manager', createdAt: new Date().toISOString() },
            { id: 'user_3', username: 'accountant', password: 'accountant123', role: 'accountant', createdAt: new Date().toISOString() }
        ];
        
        async function resetUsers() {
            const statusDiv = document.getElementById('status');
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#fff3cd';
            statusDiv.innerHTML = 'üîÑ Resetting users...';
            
            try {
                // First, get current data
                const { data: currentData, error: fetchError } = await supabaseClient
                    .from('BOTs')
                    .select('*')
                    .eq('id', 1)
                    .maybeSingle();
                
                if (fetchError) throw fetchError;
                
                // Update with default users
                const { error: updateError } = await supabaseClient
                    .from('BOTs')
                    .upsert({
                        id: 1,
                        ...currentData,
                        systemUsers: DEFAULT_USERS,
                        last_updated: new Date().toISOString()
                    });
                
                if (updateError) throw updateError;
                
                statusDiv.style.background = '#d4edda';
                statusDiv.innerHTML = '‚úÖ <strong>Success!</strong> Users reset to default.<br><br>' +
                    'Now go back to your app and login with:<br>' +
                    '<strong>Username:</strong> admin<br>' +
                    '<strong>Password:</strong> admin123';
                
                // Also clear localStorage
                localStorage.clear();
                
            } catch (error) {
                statusDiv.style.background = '#f8d7da';
                statusDiv.innerHTML = '‚ùå <strong>Error:</strong> ' + error.message;
            }
        }
    </script>
</body>
</html>
